# Unity Project Support — Implementation Plan

Overview

This document tracks the work to improve Unity project support in the Zed C# extension (`csharp_roslyn`) by making OmniSharp-Roslyn Unity-aware, automating generation/discovery of project files, and adding tests and documentation.

Goals

- Detect Unity projects reliably in the extension/project-info layer.
- Ensure OmniSharp can be started with the correct MSBuild project target (generated `.sln`/`.csproj`).
- Provide tooling to generate Unity project files when needed.
- Add tests and docs to make the workflow reproducible.

Tasks

- u1 — Detect Unity projects in `project_info` (priority: high)
  - Status: in_progress
  - Description: Add detection logic that checks for `Assets/` and `ProjectSettings/` and common Unity files (e.g. `ProjectVersion.txt`, `.asmdef` presence) and expose a helper `is_unity_project(path)`.
  - Acceptance criteria: Function exists and returns true for the `csharp_tests` sample project and false for a non-Unity repo.
  - Estimated effort: 1–2 hours
  - Owner: @omnisharp-roslyn/

- u2 — Implement `ensure_unity_project_files` helper (priority: high)
  - Status: pending
  - Description: Add a helper that attempts to locate generated `.sln`/`.csproj` files in known Unity output locations (e.g. `Temp/`, `Library/ScriptAssemblies/`) and emits a friendly message with instructions when files are missing. Optionally attempt to invoke Unity CLI if available.
  - Acceptance criteria: Helper returns a resolved project target path or a clear diagnostic suggesting steps to generate the files.
  - Estimated effort: 2–4 hours
  - Owner: @omnisharp-roslyn/

- u3 — Add Unity-specific `omnisharp.json` defaults (priority: medium)
  - Status: pending
  - Description: Provide sane defaults for Unity projects (Roslyn extension options, file excludes for `Library/`, `Temp/`, `Logs/`, disable nuget restore by default, plugin flags if used).
  - Acceptance criteria: Generated or recommended `omnisharp.json` works with OmniSharp without causing noisy errors on the sample project.
  - Estimated effort: 1 hour
  - Owner: @csharp_roslyn/

- u4 — Integrate Unity detection into the `csharp` extension (priority: high)
  - Status: pending
  - Description: Use the detection and helper from `project_info` when building the language server command and initialization options; show user notifications with steps to regenerate project files; add Unity-specific initialization options.
  - Acceptance criteria: When opening a Unity project without `.sln` files, the extension shows guidance and when `.sln` exists, OmniSharp launches with correct args.
  - Estimated effort: 3–5 hours
  - Owner: @csharp_roslyn/

- u5 — Add CLI script to generate Unity project files (priority: medium)
  - Status: pending
  - Description: Add a small helper script (POSIX shell) that attempts to locate Unity installations and runs Unity in batch mode to call `UnityEditor.SyncVS.SyncSolution` to generate project files. Document its use and fallbacks if Unity is not found.
  - Acceptance criteria: Script runs on macOS/Linux when Unity is installed and produces `.sln`/`.csproj` files for the sample project.
  - Estimated effort: 2–3 hours
  - Owner: @csharp_roslyn/

- u6 — Add unit/integration tests for Unity support (priority: high)
  - Status: pending
  - Description: Add tests to exercise `is_unity_project` and `project_target` logic. If possible, add an integration test that simulates a Unity project layout and asserts the language server command includes the correct target.
  - Acceptance criteria: Tests run locally and in CI and cover the main detection/generation code paths.
  - Estimated effort: 4–8 hours
  - Owner: @csharp_roslyn/

- u7 — Update docs and usage guide for Unity workflow (priority: low)
  - Status: pending
  - Description: Add a short guide describing the recommended workflow for Unity users: regenerate project files from the Editor, using the provided script, where to place `omnisharp.json`, and a troubleshooting checklist.
  - Acceptance criteria: A new markdown doc exists in `csharp_roslyn/` and links are added to README describing the Unity workflow.
  - Estimated effort: 1–2 hours
  - Owner: @csharp_roslyn/

Tracking and Workflow

- Progress tracking: use the task IDs (u1..u7) in PRs and commit messages.
- For each task, create a small PR that implements the change and references the task ID.
- Mark tasks complete in the project TODO list when merged.

Notes and Considerations

- Unity uses `.asmdef` assemblies which may require extra handling to map to MSBuild projects; the immediate priority is getting OmniSharp working with Unity-generated `.sln`/`.csproj` files.
- Generated project files are frequently regenerated by Unity and are normally not checked into source control; document any caveats.
- Avoid invoking Unity automatically without the user's consent; prefer to provide guidance and an optional helper script.

Next step

Start by finishing task `u1` (detect Unity projects) and then implement `u2` (helper to locate or recommend generating project files).
