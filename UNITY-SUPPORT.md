# Unity Support in Zed C# Extension

This document describes how to use the Zed C# (Roslyn) extension with Unity projects.

## Overview

The extension automatically detects Unity projects by looking for:
- `Assets/` directory
- `ProjectSettings/` directory  
- `ProjectSettings/ProjectVersion.txt` file

When a Unity project is detected, the extension:
- Uses Unity-specific OmniSharp configuration
- Excludes Unity-specific directories (`Library/`, `Temp/`, `Logs/`)
- Looks for Unity-generated `.sln` and `.csproj` files
- Shows helpful instructions when project files are missing

## Setup Workflow

### 1. Generate Project Files

Unity projects require `.sln` and `.csproj` files for the language server to work properly. These files are generated by Unity and are normally not checked into source control.

**Method 1: Using Unity Editor (Recommended)**
1. Open your Unity project in the Unity Editor
2. Go to `Edit → Preferences → External Script Editor`
3. Set your editor and click "Regenerate project files"

**Method 2: Using the provided script**
```bash
# From your Unity project root
./scripts/generate-unity-projects.sh
```

**Method 3: Using Unity CLI (Advanced)**
```bash
# Assuming Unity is in your PATH
Unity -projectPath /path/to/your/project -executeMethod UnityEditor.SyncVS.SyncSolution -quit -batchmode -nographics
```

### 2. Open in Zed

Once project files are generated:
1. Open the Unity project folder in Zed
2. The extension will automatically detect it's a Unity project
3. C# language features should work normally

## Features

### Automatic Configuration

Unity projects get these OmniSharp settings automatically:

```json
{
  "RoslynExtensionsOptions": {
    "enableDecompilationSupport": true,
    "enableImportCompletion": true,
    "enableAnalyzersSupport": true
  },
  "FileOptions": {
    "excludeSearchPatterns": [
      "**/Library/**",
      "**/Temp/**", 
      "**/Logs/**",
      "**/obj/**",
      "**/bin/**"
    ]
  },
  "Plugins": {
    "Unity": {
      "enabled": true
    }
  }
}
```

### Debugging Support

The extension supports debugging Unity projects through netcoredbg, but note:
- Only works for standalone builds, not Unity Editor play mode
- You'll need to build your project for debugging

## Troubleshooting

### "No .sln files found" message

This means Unity hasn't generated project files yet. Follow the setup workflow above to generate them.

### Language server not starting

1. Check that `.sln` files exist in your project root
2. Try regenerating project files from Unity Editor
3. Check Zed's output panel for error messages

### Intellisense not working for Unity-specific types

1. Ensure you have the correct Unity version installed
2. Check that `ProjectSettings/ProjectVersion.txt` matches your Unity installation
3. Try regenerating project files

### Files being analyzed that should be excluded

The extension excludes Unity-specific directories automatically. If you see issues:
1. Check that the directories (`Library/`, `Temp/`, etc.) exist
2. Try restarting the language server in Zed

## Advanced Configuration

You can override the default Unity settings by creating an `omnisharp.json` file in your project root:

```json
{
  "RoslynExtensionsOptions": {
    "enableDecompilationSupport": true
  },
  "FileOptions": {
    "excludeSearchPatterns": [
      "**/Library/**",
      "**/Temp/**",
      "**/CustomExcludedFolder/**"
    ]
  }
}
```

## Limitations

1. **Project files must be regenerated**: Unity often regenerates project files, so you may need to run the generation process again after major Unity Editor operations.

2. **No automatic regeneration**: The extension doesn't automatically invoke Unity to generate project files for security reasons.

3. **Editor play mode debugging**: Currently only supports standalone debugging, not Unity Editor play mode debugging.

4. **Assembly definitions**: While the extension detects `.asmdef` files, complex assembly definition setups may require manual OmniSharp configuration.

## Scripts

The extension includes a helper script at `scripts/generate-unity-projects.sh` that:
- Automatically detects Unity installations on macOS, Linux, and Windows
- Runs Unity in batch mode to generate project files
- Provides fallback instructions if Unity can't be found

Make the script executable and run it from your Unity project root:
```bash
chmod +x scripts/generate-unity-projects.sh
./scripts/generate-unity-projects.sh
```

## Contributing

Unity support is actively developed. See `UNITY-implementation-plan.md` for current tasks and progress.